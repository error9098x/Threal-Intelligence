"use client"

import type { CVE } from "@/lib/types"
import { X } from "lucide-react"

interface CveDetailsSidebarProps {
  cve: CVE
  onClose: () => void
}

export default function CveDetailsSidebar({ cve, onClose }: CveDetailsSidebarProps) {
  return (
    <div className="fixed inset-y-0 right-0 z-50 w-full sm:w-[450px] md:w-[550px] glass-panel border-l border-blue-900/30 shadow-xl overflow-y-auto">
      <div className="sticky top-0 flex justify-between items-center p-4 border-b border-blue-900/30 bg-background/80 backdrop-blur-md">
        <h2 className="text-xl font-bold text-blue-100">{cve.cveId}</h2>
        <button onClick={onClose} className="text-blue-400 hover:text-blue-100 transition-colors">
          <X className="h-5 w-5" />
        </button>
      </div>

      <div className="p-6 space-y-6">
        {/* Basic Information */}
        <div className="space-y-2">
          <h3 className="text-lg font-semibold text-blue-300">Basic Information</h3>
          <table className="w-full border-collapse">
            <tbody>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">CVE ID</th>
                <td className="py-2">{cve.cveId || "N/A"}</td>
              </tr>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">Published</th>
                <td className="py-2">{cve.publishDate || "N/A"}</td>
              </tr>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">Last Updated</th>
                <td className="py-2">{cve.updateDate || "N/A"}</td>
              </tr>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">Assigner</th>
                <td className="py-2">{cve.assignerSourceName || "N/A"}</td>
              </tr>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">NVD Status</th>
                <td className="py-2">{cve.nvdVulnStatus || "N/A"}</td>
              </tr>
            </tbody>
          </table>
        </div>

        {/* Summary */}
        <div className="space-y-2">
          <h3 className="text-lg font-semibold text-blue-300">Summary</h3>
          <p>{cve.summary || "No summary available."}</p>
        </div>

        {/* Severity & Scores */}
        <div className="space-y-2">
          <h3 className="text-lg font-semibold text-blue-300">Severity & Scores</h3>
          <table className="w-full border-collapse">
            <tbody>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">Max CVSS Base Score</th>
                <td className="py-2">{cve.maxCvssBaseScore || "N/A"}</td>
              </tr>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">CVSS v3 Score</th>
                <td className="py-2">{cve.maxCvssBaseScorev3 || "N/A"}</td>
              </tr>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">EPSS Score</th>
                <td className="py-2">{cve.epssScore ? `${Number.parseFloat(cve.epssScore) * 100}%` : "N/A"}</td>
              </tr>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">EPSS Percentile</th>
                <td className="py-2">{cve.epssPercentile || "N/A"}</td>
              </tr>
            </tbody>
          </table>
        </div>

        {/* Additional Information */}
        <div className="space-y-2">
          <h3 className="text-lg font-semibold text-blue-300">Additional Information</h3>
          <table className="w-full border-collapse">
            <tbody>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">Public Exploit</th>
                <td className="py-2">
                  {cve.exploitExists === "1" ? "Yes" : cve.exploitExists === "2" ? "Potential" : "No"}
                </td>
              </tr>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">In CISA KEV</th>
                <td className="py-2">{cve.isInCISAKEV === "1" ? "Yes" : "No"}</td>
              </tr>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">Used for Ransomware</th>
                <td className="py-2">{cve.isUsedForRansomware === "1" ? "Yes" : "No"}</td>
              </tr>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">References</th>
                <td className="py-2">{cve.referenceCount || "0"}</td>
              </tr>
              <tr className="border-b border-blue-900/20">
                <th className="text-left py-2 pr-4 text-blue-400">Weaknesses</th>
                <td className="py-2">{cve.weaknessCount || "0"}</td>
              </tr>
            </tbody>
          </table>
        </div>

        {/* External Resources */}
        <div className="space-y-2">
          <h3 className="text-lg font-semibold text-blue-300">External Resources</h3>
          <p>
            <a
              href={`https://www.cvedetails.com/cve/${cve.cveId}/`}
              target="_blank"
              rel="noopener noreferrer"
              className="text-blue-400 hover:text-blue-300 underline"
            >
              View on CVE Details Website
            </a>
          </p>
        </div>
      </div>
    </div>
  )
}
